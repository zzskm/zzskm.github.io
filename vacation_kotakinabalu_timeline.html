<!DOCTYPE html>
<html lang="ko" data-theme="light">
<script>
  // schema fixed (no runtime migration)
  const tripData = {
  "meta": {
    "version": 2,
    "timezone": "Asia/Seoul",
    "locale": "ko-KR"
  },
  "traveler": {
    "party": {
      "adults": 2,
      "children": 2,
      "childrenAges": [
        2,
        8
      ]
    }
  },
  "timeline": [
    {
      "id": "flight-2026-02-04-0",
      "type": "flight",
      "date": "2026-02-04",
      "startTime": "11:35",
      "endTime": "16:10",
      "allDay": false,
      "title": "ICN â†’ BWN",
      "subtitle": "BI652 Â· Royal Brunei Airlines",
      "status": "confirmed",
      "tags": [
        "flight",
        "outbound"
      ],
      "notes": [],
      "details": {
        "airline": "Royal Brunei Airlines",
        "flightNumber": "BI652",
        "aircraft": "A320-251N",
        "statusText": "Scheduled",
        "from": {
          "airportCode": "ICN",
          "city": "Incheon/Seoul",
          "country": "KR"
        },
        "to": {
          "airportCode": "BWN",
          "city": "Bandar Seri Begawan",
          "country": "BN"
        },
        "departLocal": "2026-02-04T11:35:00",
        "arriveLocal": "2026-02-04T16:10:00",
        "direction": "outbound"
      }
    },
    {
      "id": "hotel-2026-02-04-1",
      "type": "accommodation",
      "date": "2026-02-04",
      "startTime": "14:00",
      "endTime": "12:00",
      "allDay": false,
      "title": "Jubilee Hotel",
      "subtitle": "ì˜ˆì•½ë²ˆí˜¸: 251206210087F0ES1",
      "status": "confirmed",
      "tags": [
        "accommodation",
        "Bandar Seri Begawan"
      ],
      "notes": [],
      "details": {
        "propertyName": "Jubilee Hotel",
        "city": "Bandar Seri Begawan",
        "country": "Brunei",
        "address": "Bandar Seri Begawan, Jubilee Plaza, Jalan KG Kianggeh, Bandar Seri Begawan, Brunei, BS8111",
        "contactNumber": "673-222-8070",
        "reservation": {
          "platform": "ì—¬ê¸°ì–´ë•Œ",
          "reservationNo": "251206210087F0ES1",
          "supplierReferenceNo": "9073848482265"
        },
        "room": {
          "roomType": "Family Apartment, 2 Bedrooms, City View",
          "bed": "Single beds x4",
          "rooms": 1,
          "board": "Breakfast included",
          "benefits": [
            "Free breakfast",
            "European breakfast",
            "Free WiFi",
            "Free self parking",
            "Free valet parking"
          ],
          "specialRequests": [
            "Non-smoking",
            "High floor",
            "2 bedroom"
          ]
        },
        "checkInLocal": "2026-02-04T14:00:00",
        "checkOutLocal": "2026-02-05T12:00:00",
        "nights": 1
      }
    },
    {
      "id": "hotel-2026-02-05-3",
      "type": "accommodation",
      "date": "2026-02-05",
      "startTime": "15:00",
      "endTime": "11:00",
      "allDay": false,
      "title": "M Centro City Centre @ Gaya Street by SSVC",
      "subtitle": "ì˜ˆì•½ë²ˆí˜¸: 2512220800367FES1",
      "status": "confirmed",
      "tags": [
        "accommodation",
        "Kota Kinabalu"
      ],
      "notes": [],
      "details": {
        "propertyName": "M Centro City Centre @ Gaya Street by SSVC",
        "city": "Kota Kinabalu",
        "country": "Malaysia",
        "address": "Sabah, Kota Kinabalu, 41 Jalan Gaya, Downtown Kota Kinabalu, Kota Kinabalu, Malaysia, 88000",
        "contactNumber": "+601689893194",
        "reservation": {
          "platform": "ì—¬ê¸°ì–´ë•Œ",
          "reservationNo": "2512220800367FES1",
          "supplierReferenceNo": "1680648361"
        },
        "room": {
          "roomType": "Two Bedroom Premier Ocean View Suite",
          "bed": "King bed x2 (as listed: king 1 or king 1)",
          "rooms": 1,
          "board": "Room only",
          "benefits": [
            "Free WiFi"
          ],
          "specialRequests": [
            "Non-smoking",
            "High floor",
            "1 bed room (request)"
          ]
        },
        "checkInLocal": "2026-02-05T15:00:00",
        "checkOutLocal": "2026-02-08T11:00:00",
        "nights": 3
      }
    },
    {
      "id": "flight-2026-02-05-2",
      "type": "flight",
      "date": "2026-02-05",
      "startTime": "15:25",
      "endTime": "16:05",
      "allDay": false,
      "title": "BWN â†’ BKI",
      "subtitle": "BI825 Â· Royal Brunei Airlines",
      "status": "confirmed",
      "tags": [
        "flight",
        "outbound"
      ],
      "notes": [],
      "details": {
        "airline": "Royal Brunei Airlines",
        "flightNumber": "BI825",
        "aircraft": "A320-251N",
        "statusText": "Scheduled",
        "from": {
          "airportCode": "BWN",
          "city": "Bandar Seri Begawan",
          "country": "BN"
        },
        "to": {
          "airportCode": "BKI",
          "city": "Kota Kinabalu",
          "country": "MY"
        },
        "departLocal": "2026-02-05T15:25:00",
        "arriveLocal": "2026-02-05T16:05:00",
        "direction": "outbound"
      }
    },
    {
      "id": "tour-20260206",
      "type": "tour",
      "date": "2026-02-06",
      "startTime": null,
      "endTime": null,
      "allDay": true,
      "title": "íˆ¬ì–´ ì˜ˆì •",
      "subtitle": "planned",
      "status": "planned",
      "tags": [
        "tour",
        "planned"
      ],
      "notes": [],
      "details": {
        "description": "",
        "highlights": [],
        "durationHours": null,
        "pickupTime": null,
        "dropoffTime": null,
        "itinerary": [],
        "included": [],
        "excluded": []
      }
    },
    {
      "id": "rest-20260207",
      "type": "rest",
      "date": "2026-02-07",
      "startTime": null,
      "endTime": null,
      "allDay": true,
      "title": "íœ´ì‹",
      "subtitle": "ì»¨ë””ì…˜ íšŒë³µ",
      "status": "planned",
      "tags": [
        "rest",
        "buffer"
      ],
      "notes": [],
      "details": {
        "theme": "ì»¨ë””ì…˜ íšŒë³µ",
        "suggestedActivities": [],
        "intensity": "low"
      }
    },
    {
      "id": "tour-20260208",
      "type": "tour",
      "date": "2026-02-08",
      "startTime": null,
      "endTime": null,
      "allDay": true,
      "title": "íˆ¬ì–´ ì˜ˆì •",
      "subtitle": "planned",
      "status": "planned",
      "tags": [
        "tour",
        "planned"
      ],
      "notes": [],
      "details": {
        "description": "",
        "highlights": [],
        "durationHours": null,
        "pickupTime": null,
        "dropoffTime": null,
        "itinerary": [],
        "included": [],
        "excluded": []
      }
    },
    {
      "id": "hotel-2026-02-08-4",
      "type": "accommodation",
      "date": "2026-02-08",
      "startTime": "15:00",
      "endTime": "12:00",
      "allDay": false,
      "title": "Shangri-La Tanjung Aru, Kota Kinabalu",
      "subtitle": "ì˜ˆì•½ë²ˆí˜¸: 251221190067D0ES1",
      "status": "confirmed",
      "tags": [
        "accommodation",
        "Kota Kinabalu"
      ],
      "notes": [],
      "details": {
        "propertyName": "Shangri-La Tanjung Aru, Kota Kinabalu",
        "city": "Kota Kinabalu",
        "country": "Malaysia",
        "address": "Tanjung Aru, Sabah, Kota Kinabalu, No. 20, Jalan Aru, Tanjung Aru, Kota Kinabalu, Malaysia, 88100",
        "contactNumber": "60-88-327 888",
        "reservation": {
          "platform": "ì—¬ê¸°ì–´ë•Œ",
          "reservationNo": "251221190067D0ES1",
          "supplierReferenceNo": "320-5198134"
        },
        "room": {
          "roomType": "Tanjung Pool View King",
          "bed": "King bed x1",
          "rooms": 1,
          "board": "Bed and Breakfast",
          "benefits": [
            "Breakfast included"
          ],
          "specialRequests": [
            "Non-smoking",
            "High floor",
            "1 bed room"
          ]
        },
        "checkInLocal": "2026-02-08T15:00:00",
        "checkOutLocal": "2026-02-09T12:00:00",
        "nights": 1
      }
    },
    {
      "id": "hotel-2026-02-09-5",
      "type": "accommodation",
      "date": "2026-02-09",
      "startTime": "15:00",
      "endTime": "12:00",
      "allDay": false,
      "title": "Shangri-La Tanjung Aru, Kota Kinabalu",
      "subtitle": "ì˜ˆì•½ë²ˆí˜¸: 25120800013B34ES1",
      "status": "confirmed",
      "tags": [
        "accommodation",
        "Kota Kinabalu"
      ],
      "notes": [],
      "details": {
        "propertyName": "Shangri-La Tanjung Aru, Kota Kinabalu",
        "city": "Kota Kinabalu",
        "country": "Malaysia",
        "address": "Tanjung Aru, Sabah, Kota Kinabalu, No. 20, Jalan Aru, Tanjung Aru, Kota Kinabalu, Malaysia, 88100",
        "contactNumber": "60-88-327 888",
        "reservation": {
          "platform": "ì—¬ê¸°ì–´ë•Œ",
          "reservationNo": "25120800013B34ES1",
          "supplierReferenceNo": "320-5188110"
        },
        "room": {
          "roomType": "Tanjung Pool View King",
          "bed": "King bed x1",
          "rooms": 1,
          "board": "Bed and Breakfast",
          "benefits": [
            "Breakfast included"
          ],
          "specialRequests": [
            "Non-smoking",
            "High floor",
            "1 bed room"
          ]
        },
        "checkInLocal": "2026-02-09T15:00:00",
        "checkOutLocal": "2026-02-10T12:00:00",
        "nights": 1
      }
    },
    {
      "id": "flight-2026-02-10-6",
      "type": "flight",
      "date": "2026-02-10",
      "startTime": "21:05",
      "endTime": "21:45",
      "allDay": false,
      "title": "BKI â†’ BWN",
      "subtitle": "BI828 Â· Royal Brunei Airlines",
      "status": "confirmed",
      "tags": [
        "flight",
        "return"
      ],
      "notes": [],
      "details": {
        "airline": "Royal Brunei Airlines",
        "flightNumber": "BI828",
        "aircraft": "A320-251N",
        "statusText": "Scheduled",
        "from": {
          "airportCode": "BKI",
          "city": "Kota Kinabalu",
          "country": "MY"
        },
        "to": {
          "airportCode": "BWN",
          "city": "Bandar Seri Begawan",
          "country": "BN"
        },
        "departLocal": "2026-02-10T21:05:00",
        "arriveLocal": "2026-02-10T21:45:00",
        "direction": "return"
      }
    },
    {
      "id": "flight-2026-02-11-7",
      "type": "flight",
      "date": "2026-02-11",
      "startTime": "02:10",
      "endTime": "08:35",
      "allDay": false,
      "title": "BWN â†’ ICN",
      "subtitle": "BI651 Â· Royal Brunei Airlines",
      "status": "confirmed",
      "tags": [
        "flight",
        "return"
      ],
      "notes": [],
      "details": {
        "airline": "Royal Brunei Airlines",
        "flightNumber": "BI651",
        "aircraft": "A320-251N",
        "statusText": "Scheduled",
        "from": {
          "airportCode": "BWN",
          "city": "Bandar Seri Begawan",
          "country": "BN"
        },
        "to": {
          "airportCode": "ICN",
          "city": "Incheon/Seoul",
          "country": "KR"
        },
        "departLocal": "2026-02-11T02:10:00",
        "arriveLocal": "2026-02-11T08:35:00",
        "direction": "return"
      }
    }
  ]
};
</script>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì—¬í–‰ íƒ€ì„ë¼ì¸</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      color-scheme: light dark;
      --p:#2563eb; --s:#0ea5e9;
      --bg:#f6f8fc; --card:#ffffff; --t:#0f172a; --m:#64748b; --b:#e5eaf3;
      --soft: rgba(37,99,235,.08);
      --soft2: rgba(14,165,233,.10);
      --shadow: 0 10px 28px rgba(15,23,42,.12);
      --shadow2: 0 18px 44px rgba(15,23,42,.20);
      --ring: 0 0 0 3px rgba(37,99,235,.18);
      --radius: 18px;
    }
    [data-theme="dark"]{
      --bg:#060b16; --card:#0b1220; --t:#e5eaf3; --m:#9aa6bd; --b:#1c2740;
      --soft: rgba(37,99,235,.14);
      --soft2: rgba(14,165,233,.12);
      --shadow: 0 12px 32px rgba(0,0,0,.65);
      --shadow2: 0 20px 50px rgba(0,0,0,.75);
      --ring: 0 0 0 3px rgba(14,165,233,.20);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Noto Sans KR', system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--t);
      line-height:1.6;
      padding:12px;
      scroll-behavior:smooth;
    }
    body::before{
      content:"";
      position:fixed; inset:0; pointer-events:none; z-index:-1;
      background:
        radial-gradient(circle at 18% 10%, rgba(37,99,235,.14), transparent 42%),
        radial-gradient(circle at 80% 0%, rgba(14,165,233,.14), transparent 48%);
      opacity:.9;
    }
    .wrap{
      max-width:1100px;
      margin:auto;
      background:var(--card);
      border:1px solid var(--b);
      border-radius:22px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    header{
      position:relative;
      padding:16px 16px 12px;
      border-bottom:1px solid var(--b);
      background:linear-gradient(135deg, rgba(37,99,235,.12), rgba(14,165,233,.10));
    }
    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .title{
      display:flex; flex-direction:column; gap:2px;
    }
    h1{font-size:1.18rem; font-weight:950; letter-spacing:-.03em}
    .sub{color:var(--m); font-weight:800; font-size:.9rem}

    .toggle{
      width:42px; height:42px;
      border-radius:999px;
      border:1px solid rgba(15,23,42,.12);
      background:rgba(255,255,255,.55);
      cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      backdrop-filter: blur(10px);
      transition:transform .12s ease, background .2s ease, border-color .2s ease;
    }
    [data-theme="dark"] .toggle{background:rgba(255,255,255,.08); border-color:rgba(255,255,255,.14);}
    .toggle:active{transform:scale(.98)}
    .toggle:focus-visible{outline:none; box-shadow:var(--ring);}

    .hero{
      margin-top:10px;
      display:grid; gap:8px;
      grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));
    }
    .hero-card{
      border:1px solid rgba(15,23,42,.08);
      background:rgba(255,255,255,.55);
      border-radius:14px;
      padding:10px 10px;
      backdrop-filter: blur(10px);
    }
    [data-theme="dark"] .hero-card{background:rgba(255,255,255,.04); border-color:rgba(255,255,255,.10);}
    .hero-k{color:var(--m); font-weight:900; font-size:.78rem; letter-spacing:.03em}
    .hero-v{font-weight:950; margin-top:2px; font-size:.95rem}

    nav{
      display:flex; gap:8px; flex-wrap:wrap;
      padding:10px 12px;
      border-bottom:1px solid var(--b);
      position:sticky; top:10px; z-index:5;
      background:rgba(255,255,255,.70);
      backdrop-filter: blur(12px);
    }
    [data-theme="dark"] nav{background:rgba(11,18,32,.70);}
    .nav-btn{
      border:1px solid var(--b);
      background:var(--soft);
      color:var(--t);
      padding:7px 12px;
      border-radius:999px;
      font-weight:900;
      font-size:.88rem;
      cursor:pointer;
      transition:transform .12s ease, background .2s ease;
    }
    .nav-btn:active{transform:scale(.98)}
    .nav-btn:focus-visible{outline:none; box-shadow:var(--ring);}
    .nav-btn.active{background:var(--p); color:#fff; border-color:var(--p);}

    .sec{padding:14px 16px; border-bottom:1px solid var(--b);}
    .sec:last-child{border-bottom:none;}
    h2{
      font-size:1.02rem; font-weight:950; color:var(--p);
      letter-spacing:-.02em;
      display:flex; align-items:center; gap:8px;
      margin-bottom:10px;
    }

    .timeline{display:grid; gap:10px;}

    .dayHeader{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:10px;
      padding-top:10px;
    }
    .dayHeader span:first-child{
      font-weight:950;
      letter-spacing:-.02em;
      color:var(--t);
    }
    .dayHeader .dayLine{
      height:1px;
      background:linear-gradient(90deg, rgba(148,163,184,.65), rgba(148,163,184,0));
      flex:1;
    }

    .titem{
      display:grid; grid-template-columns:110px 1fr 40px;
      gap:12px;
      padding:12px;
      border-radius:var(--radius);
      border:1px solid var(--b);
      background:var(--soft);
      align-items:center;
    }
    @media (max-width:720px){
      .titem{grid-template-columns:1fr; gap:10px;}
      .ticon{display:none;}
      .badge{flex-direction:row; justify-content:flex-start; gap:10px; padding:10px 12px; text-align:left;}
      .badge .date{font-size:.88rem;}
      .badge .time{font-size:1rem;}
    }
    .badge{
      border-radius:16px;
      background:linear-gradient(135deg, rgba(37,99,235,1), rgba(14,165,233,1));
      color:#fff;
      padding:10px 10px;
      box-shadow:0 12px 24px rgba(37,99,235,.28);
      display:flex; flex-direction:column; justify-content:center; align-items:center; gap:2px;
      text-align:center;
    }
    .badge .type{font-size:.76rem; font-weight:950; opacity:.96;}
    .badge .date{font-size:.9rem; font-weight:950;}
    .badge .time{font-size:1.05rem; font-weight:950; letter-spacing:.02em;}
    .tmain h3{font-size:1rem; font-weight:950; letter-spacing:-.02em;}
    .tmain p{color:var(--m); font-weight:800; margin-top:2px; font-size:.92rem;}
    .tmain .mainline{margin-top:4px; color:var(--t); font-weight:950;}
    .chips{display:flex; flex-wrap:wrap; gap:6px; margin-top:8px;}
    .chip{background:var(--soft2); border:1px solid rgba(14,165,233,.25); color:#0369a1; padding:3px 10px; border-radius:999px; font-weight:950; font-size:.80rem;}

    .grid{display:grid; gap:12px; grid-template-columns:repeat(auto-fit, minmax(260px, 1fr));}
    .card{
      position:relative;
      border:1px solid var(--b);
      border-radius:var(--radius);
      padding:12px 12px 12px;
      background:linear-gradient(145deg, rgba(255,255,255,.70), rgba(37,99,235,.03));
      box-shadow:0 10px 24px rgba(15,23,42,.06);
      overflow:hidden;
    }
    [data-theme="dark"] .card{background:linear-gradient(145deg, rgba(255,255,255,.04), rgba(37,99,235,.06));}
    .pill{display:inline-flex; gap:6px; align-items:center; background:var(--soft2); border:1px solid rgba(14,165,233,.25); color:#0369a1; padding:3px 10px; border-radius:999px; font-weight:950; font-size:.80rem;}
    .card h3{margin-top:8px; font-size:1.02rem; font-weight:950; letter-spacing:-.02em;}
    .card p{margin-top:4px; color:var(--m); font-weight:800; font-size:.92rem;}
    .mini{margin-top:8px; display:grid; gap:6px;}
    .mini-row{display:flex; gap:8px; align-items:flex-start; font-size:.9rem;}
    .mini-k{min-width:86px; color:var(--m); font-weight:900;}
    .mini-v{font-weight:950; word-break:break-word;}

    /* icon button (mobile-friendly) */
    .icon-btn{
      position:static;
      width:44px; height:44px;
      border-radius:999px;
      border:1px solid rgba(15,23,42,.12);
      background:rgba(255,255,255,.65);
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
      transition:transform .12s ease, background .2s ease, border-color .2s ease;
      backdrop-filter: blur(10px);
    }
    [data-theme="dark"] .icon-btn{background:rgba(255,255,255,.08); border-color:rgba(255,255,255,.14);}
    .icon-btn:active{transform:scale(.98)}
    .icon-btn:focus-visible{outline:none; box-shadow:var(--ring);}
    .icon{
      width:18px; height:18px; display:block;
      fill:currentColor; color:var(--t);
    }
    [data-theme="dark"] .icon{color:#e5eaf3;}

    .copy-btn{
      border:1px solid var(--b);
      background:rgba(37,99,235,.08);
      color:var(--t);
      padding:4px 10px;
      border-radius:999px;
      font-weight:950;
      font-size:.82rem;
      cursor:pointer;
    }
    .copy-btn:focus-visible{outline:none; box-shadow:var(--ring);}

    /* Modal */
    .modal{position:fixed; inset:0; display:none; z-index:999; align-items:center; justify-content:center; padding:14px;}
    .modal.show{display:flex;}
    .modal-overlay{position:absolute; inset:0; background:rgba(15,23,42,.68); backdrop-filter: blur(10px);}
    .modal-panel{
      position:relative;
      width:min(920px, 100%);
      max-height:90vh;
      overflow:auto;
      background:var(--card);
      border:1px solid var(--b);
      border-radius:20px;
      box-shadow:var(--shadow2);
      padding:14px 14px 12px;
    }
    .modal-head{display:flex; justify-content:space-between; gap:10px; align-items:flex-start; margin-bottom:10px;}
    .modal-title{font-size:1.1rem; font-weight:950; letter-spacing:-.02em;}
    .modal-sub{color:var(--m); font-weight:800; margin-top:2px; font-size:.92rem;}
    .modal-close{
      border:1px solid var(--b);
      background:var(--soft);
      padding:8px 12px;
      border-radius:999px;
      font-weight:950;
      cursor:pointer;
      white-space:nowrap;
    }
    .modal-close:focus-visible{outline:none; box-shadow:var(--ring);}
    .modal-big{margin:10px 0 12px; padding:12px 12px; border-radius:16px; border:1px solid rgba(37,99,235,.22); background:var(--soft);}
    .modal-big .lbl{color:var(--m); font-weight:950; font-size:.84rem; margin-bottom:4px;}
    .modal-big .val{font-weight:950; font-size:1.02rem; word-break:break-word; display:flex; flex-wrap:wrap; gap:8px; align-items:center;}

    .toast{
      position:fixed; left:50%; bottom:12px;
      transform:translateX(-50%) translateY(18px);
      background:rgba(15,23,42,.92);
      color:#fff;
      padding:10px 14px;
      border-radius:999px;
      font-weight:950;
      opacity:0; pointer-events:none;
      transition:opacity .18s ease, transform .18s ease;
      z-index:1000;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(0);}

    footer{padding:10px 16px; color:var(--m); font-weight:800; font-size:.85rem;}
    #backToTop{
      position:fixed; right:12px; bottom:12px;
      width:46px; height:46px;
      border:none; border-radius:999px;
      background:linear-gradient(135deg, rgba(37,99,235,1), rgba(14,165,233,1));
      color:#fff;
      box-shadow:0 12px 28px rgba(37,99,235,.35);
      cursor:pointer;
      opacity:0; pointer-events:none;
      transform:translateY(10px);
      transition:opacity .2s ease, transform .2s ease;
      z-index:998;
      font-weight:950;
    }
    #backToTop.show{opacity:1; pointer-events:auto; transform:translateY(0);}

    @media (prefers-reduced-motion: reduce){
      *{transition:none!important; animation:none!important; scroll-behavior:auto!important;}
    }
  
    body.no-scroll{ overflow:hidden; }

    .card-top{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .card .meta{ margin-top:6px; color:var(--m); font-weight:800; font-size:.85rem; }
    .card-click{ cursor:pointer; }
    .card-click:focus{ outline:none; box-shadow:var(--ring); }

    .details{ display:block; }
    .kv{ display:grid; grid-template-columns: 110px 1fr; gap:10px; padding:10px 0; border-bottom:1px solid var(--b); }
    .kv .k{ color:var(--m); font-weight:900; font-size:.86rem; letter-spacing:-.01em; }
    .kv .v{ font-weight:800; }
    .sep{ border:none; border-top:1px solid var(--b); margin:10px 0; }
    .note{ margin-top:10px; color:var(--m); font-weight:800; font-size:.85rem; }
    .muted{ color:var(--m); font-weight:800; font-size:.85rem; }

</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="topbar">
        <div class="title">
          <h1>ì—¬í–‰ íƒ€ì„ë¼ì¸</h1>
          <div class="sub">í•­ê³µ Â· ìˆ™ì†Œ Â· íˆ¬ì–´(ì˜ˆì •)</div>
        </div>
        <button class="toggle" id="themeToggle" aria-label="í…Œë§ˆ ì „í™˜">ğŸŒ“</button>
      </div>
      <div class="hero" id="hero"></div>
    </header>

    <nav aria-label="ì„¹ì…˜ ì´ë™">
      <button class="nav-btn" data-target="timeline">ì „ì²´</button>
      <button class="nav-btn" data-target="flights">í•­ê³µ</button>
      <button class="nav-btn" data-target="stays">ìˆ™ì†Œ</button>
      <button class="nav-btn" data-target="tours">íˆ¬ì–´</button>
    </nav>

    <section class="sec" id="timeline">
      <h2>ğŸ§­ ì „ì²´ íƒ€ì„ë¼ì¸</h2>
      <div class="timeline" id="timelineList"></div>
    </section>

    <section class="sec" id="flights">
      <h2>âœˆï¸ í•­ê³µ</h2>
      <div class="grid" id="flightGrid"></div>
    </section>

    <section class="sec" id="stays">
      <h2>ğŸ¨ ìˆ™ì†Œ</h2>
      <div class="grid" id="stayGrid"></div>
    </section>

    <section class="sec" id="tours">
      <h2>ğŸ§­ íˆ¬ì–´</h2>
      <div class="grid" id="tourGrid"></div>
    </section>

    <footer>
      ìƒì„±ì¼: <span id="generatedAt"></span>
    </footer>
  </div>

  <button id="backToTop" aria-label="ë§¨ ìœ„ë¡œ">â†‘</button>
  <div class="toast" id="toast">ë³µì‚¬ë¨ âœ…</div>

  <div class="modal" id="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="modal-panel" role="document">
      <div class="modal-head">
        <div>
          <div class="modal-title" id="modalTitle">ìƒì„¸</div>
          <div class="modal-sub" id="modalSub"></div>
        </div>
        <button class="modal-close" id="modalClose" type="button">ë‹«ê¸°</button>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>

<script>
/* utils */
function parseISO(s){ return new Date(s); }
function fmtYMD(d){ return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,'0')+"-"+String(d.getDate()).padStart(2,'0'); }
function fmtTime(d){ return String(d.getHours()).padStart(2,'0')+":"+String(d.getMinutes()).padStart(2,'0'); }
function fmtK(d){
  const wd=d.toLocaleDateString('ko-KR',{weekday:'short'});
  const md=d.toLocaleDateString('ko-KR',{month:'numeric',day:'numeric'});
  return `${md}(${wd})`;
}
function escapeHtml(str){
  return String(str ?? "").replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
}
function maskCode(s){
  const v = String(s || "");
  if(!v) return "";
  if(v.length <= 4) return "****";
  return "****" + v.slice(-4);
}
function pad2(n){ return String(n).padStart(2,'0'); }
function toLocalISOString(d){ return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}T${pad2(d.getHours())}:${pad2(d.getMinutes())}:${pad2(d.getSeconds())}`; }
function makeDate(dateStr, timeStr){ const t=timeStr||"00:00"; return new Date(dateStr+"T"+t+":00"); }
function diffNights(start, end){ return Math.max(0, Math.round((end-start)/(1000*60*60*24))); }

/* toast + copy */
function showToast(msg="ë³µì‚¬ë¨ âœ…") {
  const t=document.getElementById('toast'); if(!t) return;
  t.textContent=msg; t.classList.add('show');
  clearTimeout(showToast._t); showToast._t=setTimeout(()=>t.classList.remove('show'), 950);
}
async function copyText(text) {
  try { await navigator.clipboard.writeText(text); showToast(); }
  catch {
    const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta);
    ta.select(); document.execCommand('copy'); document.body.removeChild(ta); showToast();
  }
}

/* -------- schema -------- */
/* -------- normalize -------- */
function normalizeEvents(trip) {
  const out = [];
  const list = trip.timeline || [];
  list.forEach((ev)=>{
    if(!ev || !ev.id || !ev.type || !ev.date) {
      console.warn("[normalize] invalid event:", ev);
      return;
    }

    let startAt = null, endAt = null;
    const d = ev.details || {};

    // Prefer precise timestamps when available
    if(ev.type === "flight" && d.departLocal && d.arriveLocal) {
      startAt = parseISO(d.departLocal);
      endAt = parseISO(d.arriveLocal);
    } else if(ev.type === "accommodation" && d.checkInLocal && d.checkOutLocal) {
      startAt = parseISO(d.checkInLocal);
      endAt = parseISO(d.checkOutLocal);
    } else {
      startAt = (ev.allDay || !ev.startTime) ? makeDate(ev.date, "00:00") : makeDate(ev.date, ev.startTime);
      if(ev.allDay && !ev.endTime) endAt = makeDate(ev.date, "23:59");
      else if(ev.endTime) {
        // When endTime is earlier than startTime, assume next day
        const candidate = makeDate(ev.date, ev.endTime);
        endAt = candidate < startAt ? new Date(candidate.getTime() + 24*60*60*1000) : candidate;
      } else endAt = startAt;
    }

    out.push({
      type: ev.type,
      start: startAt,
      end: endAt,
      raw: ev
    });
  });

  out.sort((a,b)=>a.start - b.start);
  return out;
}

/* icons */
function magnifierSVG() {
  return `
    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M10 4a6 6 0 1 1 0 12A6 6 0 0 1 10 4m0-2a8 8 0 1 0 4.9 14.3l4.4 4.4a1 1 0 0 0 1.4-1.4l-4.4-4.4A8 8 0 0 0 10 2z"/>
    </svg>`;
}

/* header */
function renderHero(events, trip) {
  const flights=events.filter(e=>e.type==='flight');
  const stays=events.filter(e=>e.type==='accommodation');
  const tours=events.filter(e=>e.type==='tour');
  const rests=events.filter(e=>e.type==='rest');

  const start=events[0]?.start, end=events[events.length-1]?.end;
  const totalNights = stays.reduce((a,s)=>a+diffNights(s.start, s.end), 0);

  const guest = trip.traveler?.guestName || "-";
  const party = trip.traveler?.party;
  const guests = party ? `ì„±ì¸ ${party.adults} / ì•„ë™ ${party.children} (ë§Œ ${(party.childrenAges||[]).join(', ')})` : "-";
  const range = (start && end) ? `${fmtYMD(start)} â†’ ${fmtYMD(end)}` : "-";

  const cards = [
    {k:"ê¸°ê°„", v:range},
    {k:"í•­ê³µ", v:`${flights.length}êµ¬ê°„`},
    {k:"ìˆ™ì†Œ", v:`${stays.length}ê±´ / ${totalNights}ë°•`},
    {k:"íˆ¬ì–´", v:`${tours.length}ê±´`},
  ];
  document.getElementById('hero').innerHTML = cards.map(c=>`
    <div class="hero-card">
      <div class="hero-k">${escapeHtml(c.k)}</div>
      <div class="hero-v">${escapeHtml(c.v)}</div>
    </div>
  `).join('');
}

function badgeTimeLabel(e){
  const ev=e.raw;
  if(e.type==='tour' || e.type==='rest') return "ë¯¸ì •";
  if(ev.allDay) return "ì¢…ì¼";
  if(ev.startTime) return ev.startTime;
  return fmtTime(e.start);
}

/* timeline */
function renderTimeline(events) {
  const el = document.getElementById('timelineList');

  const handlers = {
    flight: (e)=>{
      const d=e.raw.details||{};
      const dir = d.direction==='outbound'?'ê°€ëŠ”í¸':(d.direction==='return'?'ì˜¤ëŠ”í¸':'í•­ê³µ');
      return {
        typeLabel: "í•­ê³µ",
        title: e.raw.title || `${d.from?.airportCode || "???"} â†’ ${d.to?.airportCode || "???"}`,
        sub: `${dir}${d.flightNumber || d.airline ? " Â· " : ""}${`${d.flightNumber || ""}${d.airline ? " Â· "+d.airline : ""}`.trim()}`.trim(),
        main: `${fmtTime(e.start)} â†’ ${fmtTime(e.end)}`,
        chips: [d.aircraft||"", d.statusText||""].filter(Boolean).slice(0,2)
      };
    },
    accommodation: (e)=>{
      const d=e.raw.details||{};
      const city = `${d.city || ""}${d.country ? ", "+d.country : ""}`.trim();
      return {
        typeLabel: "ìˆ™ì†Œ",
        title: e.raw.title || d.propertyName || "ìˆ™ì†Œ",
        sub: `${city}${city ? " Â· " : ""}${diffNights(e.start,e.end)}ë°•`.trim(),
        main: `ì²´í¬ì¸ ${fmtTime(e.start)} Â· ì²´í¬ì•„ì›ƒ ${fmtTime(e.end)}`,
        // íƒ€ì„ë¼ì¸ì—ì„œë„ ì˜ˆì•½ë²ˆí˜¸ ë…¸ì¶œ ê¸ˆì§€(ëª¨ë‹¬ ì „ìš©)
        chips: [d.board || "", d.roomType || ""].filter(Boolean).slice(0,2)
      };
    },
    tour: (e)=>{
      const time = (e.raw.startTime || e.raw.endTime) ? `${e.raw.startTime || '??:??'} â†’ ${e.raw.endTime || '??:??'}` : 'ì‹œê°„ ë¯¸ì •';
      return { typeLabel:"íˆ¬ì–´", title:e.raw.title || "íˆ¬ì–´", sub:(e.raw.status || "planned"), main:time, chips:[] };
    },
    rest: (e)=>({ typeLabel:"íœ´ì‹", title:e.raw.title || "íœ´ì‹", sub:e.raw.subtitle || "ì»¨ë””ì…˜ íšŒë³µ", main:"", chips:[] })
  };

  // ë‚ ì§œë³„ë¡œ í—¤ë”ë¥¼ ë„£ì–´ì„œ ìŠ¤ìº”ì´ ì‰¬ìš´ íƒ€ì„ë¼ì¸ìœ¼ë¡œ
  let lastDay = "";
  el.innerHTML = events.map(e=>{
    const h = handlers[e.type] ? handlers[e.type](e) : {typeLabel:e.type, title:e.raw.title||"", sub:"", main:"", chips:[]};
    const dayKey = fmtYMD(e.start);
    const header = (dayKey !== lastDay) ? (()=>{ lastDay = dayKey; return `<div class="dayHeader"><span>${escapeHtml(fmtK(e.start))}</span><span class="dayLine"></span></div>`; })() : "";

    const timeLabel = e.raw.allDay ? "ALL" : fmtTime(e.start);
    const md = e.start.toLocaleDateString('ko-KR',{month:'numeric',day:'numeric'});

    return `
      ${header}
      <div class="titem card-click" tabindex="0" role="button" data-type="${escapeHtml(e.type)}" data-open-id="${escapeHtml(e.raw.id)}" aria-label="ìƒì„¸ ì—´ê¸°">
        <div class="badge">
          <div class="type">${escapeHtml(h.typeLabel)}</div>
          <div class="date">${escapeHtml(md)}</div>
          <div class="time">${escapeHtml(timeLabel)}</div>
        </div>

        <div class="tmain">
          <h3>${escapeHtml(h.title)}</h3>
          ${h.sub?`<p>${escapeHtml(h.sub)}</p>`:""}
          ${h.main?`<div class="mainline">${escapeHtml(h.main)}</div>`:""}
          ${h.chips?.length?`<div class="chips">${h.chips.map(c=>`<span class="chip">${escapeHtml(c)}</span>`).join('')}</div>`:""}
        </div>

        <button class="icon-btn ticon" data-open-id="${escapeHtml(e.raw.id)}" aria-label="ìƒì„¸ ë³´ê¸°" type="button">${magnifierSVG()}</button>
      </div>
    `;
  }).join('');
}

/* cards */
function renderFlights(flights) {
  const grid = document.getElementById('flightGrid');
  grid.innerHTML = flights.map((e)=>{
    const d = e.raw.details || {};
    const dir = d.direction === 'outbound' ? 'ê°€ëŠ”í¸' : (d.direction === 'return' ? 'ì˜¤ëŠ”í¸' : 'í•­ê³µ');
    const ymd = e.raw.date;
    const title = e.raw.title || `${d.from?.airportCode || "???"} â†’ ${d.to?.airportCode || "???"}`;
    const subtitle = `${fmtTime(e.start)} â†’ ${fmtTime(e.end)}`;
    const meta = e.raw.subtitle || `${d.flightNumber || ''}${d.airline ? ' Â· ' + d.airline : ''}`.trim();
    return `
      <article class="card card-click" tabindex="0" role="button" data-open-id="${escapeHtml(e.raw.id)}" aria-label="í•­ê³µ ìƒì„¸ ì—´ê¸°">
        <div class="card-top">
          <span class="pill">${escapeHtml(dir)} Â· ${escapeHtml(ymd)}</span>
          <button class="icon-btn" data-open-id="${escapeHtml(e.raw.id)}" aria-label="í•­ê³µ ìƒì„¸ ë³´ê¸°" type="button">${magnifierSVG()}</button>
        </div>
        <h3>${escapeHtml(title)}</h3>
        <p>${escapeHtml(subtitle)}</p>
        <div class="meta">${escapeHtml(meta || '')}</div>
      </article>
    `;
  }).join('');
}

function renderStays(stays) {
  const grid = document.getElementById('stayGrid');
  grid.innerHTML = stays.map((e)=>{
    const d = e.raw.details || {};
    const nights = diffNights(e.start, e.end);
    const city = (d.city || '').trim();
    const title = e.raw.title || d.propertyName || 'ìˆ™ì†Œ';

    // ì¹´ë“œ: ìŠ¤ìº”ìš© ìš”ì•½ë§Œ (ì˜ˆì•½ë²ˆí˜¸/ë ˆí¼ëŸ°ìŠ¤ëŠ” ëª¨ë‹¬ì—ì„œë§Œ)
    const pill = `ìˆ™ì†Œ Â· ${fmtK(e.start)}`;
    const subtitle = `${fmtK(e.start)} ${fmtTime(e.start)} ì²´í¬ì¸ Â· ${nights}ë°• Â· ${fmtK(e.end)} ${fmtTime(e.end)} ì²´í¬ì•„ì›ƒ`;
    const meta = city ? city : '';

    return `
      <article class="card card-click" tabindex="0" role="button" data-open-id="${escapeHtml(e.raw.id)}" aria-label="ìˆ™ì†Œ ìƒì„¸ ì—´ê¸°">
        <div class="card-top">
          <span class="pill">${escapeHtml(pill)}</span>
          <button class="icon-btn" data-open-id="${escapeHtml(e.raw.id)}" aria-label="ìˆ™ì†Œ ìƒì„¸ ë³´ê¸°" type="button">${magnifierSVG()}</button>
        </div>
        <h3>${escapeHtml(title)}</h3>
        <p>${escapeHtml(subtitle)}</p>
        ${meta ? `<div class="meta">${escapeHtml(meta)}</div>` : ``}
      </article>
    `;
  }).join('');
}

function renderTours(tours) {
  const grid = document.getElementById('tourGrid');
  if(!grid) return;
  grid.innerHTML = tours.map((e)=>{
    const d = e.raw.details || {};
    const time = (e.raw.startTime || e.raw.endTime) ? `${e.raw.startTime || '??:??'} â†’ ${e.raw.endTime || '??:??'}` : 'ì‹œê°„ ë¯¸ì •';
    const meta = e.raw.status ? `ìƒíƒœ: ${e.raw.status}` : '';
    return `
      <article class="card card-click" tabindex="0" role="button" data-open-id="${escapeHtml(e.raw.id)}" aria-label="íˆ¬ì–´ ìƒì„¸ ì—´ê¸°">
        <div class="card-top">
          <span class="pill">${escapeHtml(e.raw.date)}</span>
          <button class="icon-btn" data-open-id="${escapeHtml(e.raw.id)}" aria-label="íˆ¬ì–´ ìƒì„¸ ë³´ê¸°" type="button">${magnifierSVG()}</button>
        </div>
        <h3>${escapeHtml(e.raw.title || 'íˆ¬ì–´')}</h3>
        <p>${escapeHtml(time)}</p>
        <div class="meta">${escapeHtml(meta)}</div>
      </article>
    `;
  }).join('');
}

/* modal */
let __lastFocus = null;

function openModal(title, sub, bodyHtml) {
  __lastFocus = document.activeElement;
  document.getElementById('modalTitle').textContent = title || 'ìƒì„¸';
  document.getElementById('modalSub').textContent = sub || '';
  document.getElementById('modalBody').innerHTML = bodyHtml || '';
  const modal=document.getElementById('modal');
  modal.classList.add('show');
  modal.setAttribute('aria-hidden','false');
  document.body.classList.add('no-scroll');
  // focus close for accessibility
  setTimeout(()=>document.getElementById('modalClose').focus(), 0);
}

function closeModal() {
  const modal=document.getElementById('modal');
  modal.classList.remove('show');
  modal.setAttribute('aria-hidden','true');
  document.body.classList.remove('no-scroll');
  if(__lastFocus && __lastFocus.focus) __lastFocus.focus();
}

function openEventModal(id) {
  const byId = window.__byId;
  if(!byId) return;
  const item = byId.get(id);
  if(!item) return;

  const type = item.type;
  if(type === 'flight') return openFlight(item);
  if(type === 'accommodation') return openStay(item);
  if(type === 'tour') return openTour(item);
  if(type === 'rest') return openRest(item);

  // fallback
  openModal(item.raw.title || 'ìƒì„¸', item.raw.subtitle || '', `<pre>${escapeHtml(JSON.stringify(item.raw, null, 2))}</pre>`);
}

function openStay(item) {
  const d = item.raw.details || {};
  const pn = d.reservation?.reservationNo || '-';
  const sn = d.reservation?.supplierReferenceNo || '-';
  const guest = window.__trip?.traveler?.guestName || '-';
  const party = window.__trip?.traveler?.party;
  const guests = party ? `ì„±ì¸ ${party.adults} / ì•„ë™ ${party.children} (ë§Œ ${(party.childrenAges||[]).join(', ')})` : '-';

  const sub = `${d.city || ''}${d.country ? ', '+d.country : ''} Â· ì²´í¬ì¸ ${fmtYMD(item.start)} ${fmtTime(item.start)} â†’ ì²´í¬ì•„ì›ƒ ${fmtYMD(item.end)} ${fmtTime(item.end)} Â· ${diffNights(item.start,item.end)}ë°•`;

  const body = `
    <div class="details">
      <div class="kv"><div class="k">ì˜ˆì•½ë²ˆí˜¸</div><div class="v"><code>${escapeHtml(pn)}</code> <button class="copy-btn" data-copy="${escapeHtml(pn)}" type="button">ë³µì‚¬</button></div></div>
      <div class="kv"><div class="k">ê³µê¸‰ì‚¬ ë²ˆí˜¸</div><div class="v"><code>${escapeHtml(sn)}</code> <button class="copy-btn" data-copy="${escapeHtml(sn)}" type="button">ë³µì‚¬</button></div></div>
      <div class="kv"><div class="k">íˆ¬ìˆ™ ì¸ì›</div><div class="v">${escapeHtml(guests)}</div></div>
      <hr class="sep"/>
      <div class="kv"><div class="k">ê°ì‹¤ íƒ€ì…</div><div class="v">${escapeHtml(d.room?.roomType || '-')}</div></div>
      <div class="kv"><div class="k">ì¹¨ëŒ€</div><div class="v">${escapeHtml(d.room?.bed || '-')}</div></div>
      <div class="kv"><div class="k">ì¡°ì‹/í”Œëœ</div><div class="v">${escapeHtml(d.room?.board || '-')}</div></div>
      <div class="kv"><div class="k">í˜œíƒ</div><div class="v">${escapeHtml((d.room?.benefits||[]).filter(Boolean).join(', ') || '-')}</div></div>
      <div class="kv"><div class="k">ìš”ì²­ì‚¬í•­</div><div class="v">${escapeHtml((d.room?.specialRequests||[]).filter(Boolean).join(', ') || 'ìš”ì²­ ì—†ìŒ')}</div></div>
      <hr class="sep"/>
      <div class="kv"><div class="k">ì—°ë½ì²˜</div><div class="v">${escapeHtml(d.contactNumber || '-')}</div></div>
      <div class="kv"><div class="k">ì£¼ì†Œ</div><div class="v">${escapeHtml(d.address || '-')}</div></div>
    </div>
    <p class="note">â€» ìš”ì²­ì‚¬í•­ì€ ìˆ™ì†Œ ì‚¬ì •ì— ë”°ë¼ ë°˜ì˜ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  `;
  openModal(d.propertyName || item.raw.title || 'ìˆ™ì†Œ ìƒì„¸', sub, body);
}

function openFlight(item) {
  const d = item.raw.details || {};
  const dir = d.direction==='outbound'?'ê°€ëŠ”í¸':(d.direction==='return'?'ì˜¤ëŠ”í¸':'í•­ê³µ');
  const sub = `${dir} Â· ${fmtYMD(item.start)} ${fmtTime(item.start)} â†’ ${fmtYMD(item.end)} ${fmtTime(item.end)}`;

  const body = `
    <div class="details">
      <div class="kv"><div class="k">í¸ëª…</div><div class="v"><code>${escapeHtml(d.flightNumber || '-')}</code></div></div>
      <div class="kv"><div class="k">í•­ê³µì‚¬</div><div class="v">${escapeHtml(d.airline || '-')}</div></div>
      <div class="kv"><div class="k">ê¸°ì¢…</div><div class="v">${escapeHtml(d.aircraft || '-')}</div></div>
      <div class="kv"><div class="k">ìƒíƒœ</div><div class="v">${escapeHtml(d.statusText || '-')}</div></div>
      <hr class="sep"/>
      <div class="kv"><div class="k">ì¶œë°œ</div><div class="v">${escapeHtml(`${d.from?.city || ''} (${d.from?.airportCode || '-'})`)}<br/><span class="muted">${escapeHtml(d.departLocal || '')}</span></div></div>
      <div class="kv"><div class="k">ë„ì°©</div><div class="v">${escapeHtml(`${d.to?.city || ''} (${d.to?.airportCode || '-'})`)}<br/><span class="muted">${escapeHtml(d.arriveLocal || '')}</span></div></div>
    </div>
  `;
  openModal(item.raw.title || 'í•­ê³µ ìƒì„¸', sub, body);
}

function openTour(item) {
  const d = item.raw.details || {};
  const time = (item.raw.startTime || item.raw.endTime) ? `${item.raw.startTime || '??:??'} â†’ ${item.raw.endTime || '??:??'}` : 'ì‹œê°„ ë¯¸ì •';
  const sub = `${escapeHtml(item.raw.date)} Â· ${escapeHtml(time)} Â· ${escapeHtml(item.raw.status || 'planned')}`;

  const body = `
    <div class="details">
      <div class="kv"><div class="k">ì„¤ëª…</div><div class="v">${escapeHtml(d.description || 'ë¯¸ì •')}</div></div>
      <div class="kv"><div class="k">í•˜ì´ë¼ì´íŠ¸</div><div class="v">${escapeHtml((d.highlights||[]).join(', ') || 'ë¯¸ì •')}</div></div>
      <div class="kv"><div class="k">í¬í•¨</div><div class="v">${escapeHtml((d.included||[]).join(', ') || 'ë¯¸ì •')}</div></div>
      <div class="kv"><div class="k">ë¶ˆí¬í•¨</div><div class="v">${escapeHtml((d.excluded||[]).join(', ') || 'ë¯¸ì •')}</div></div>
    </div>
  `;
  openModal(item.raw.title || 'íˆ¬ì–´ ìƒì„¸', sub, body);
}

function openRest(item) {
  const d = item.raw.details || {};
  const sub = `${escapeHtml(item.raw.date)} Â· ${escapeHtml(d.theme || 'íœ´ì‹')}`;
  const body = `
    <div class="details">
      <div class="kv"><div class="k">í…Œë§ˆ</div><div class="v">${escapeHtml(d.theme || '-')}</div></div>
      <div class="kv"><div class="k">ì¶”ì²œ í™œë™</div><div class="v">${escapeHtml((d.suggestedActivities||[]).join(', ') || 'ì—†ìŒ')}</div></div>
      <div class="kv"><div class="k">ê°•ë„</div><div class="v">${escapeHtml(d.intensity || '-')}</div></div>
    </div>
  `;
  openModal(item.raw.title || 'íœ´ì‹', sub, body);
}




/* setup */
function setupCopy() {
  document.addEventListener('click', (e)=>{
    const btn = e.target.closest('.copy-btn');
    if(!btn) return;
    const txt = btn.getAttribute('data-copy');
    if(txt) copyText(txt);
  });
}
function setupModal() {
  const overlay = document.getElementById('modalOverlay');
  const closeBtn = document.getElementById('modalClose');

  overlay.addEventListener('click', (e)=>{
    if(e.target === overlay) closeModal();
  });
  closeBtn.addEventListener('click', closeModal);

  // Open: event delegation (cards + icons)
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-id]');
    if(!t) return;
    const id = t.getAttribute('data-open-id');
    if(!id) return;
    // Prevent nested clicks from closing etc.
    e.preventDefault();
    openEventModal(id);
  });

  // Keyboard open for cards
  document.addEventListener('keydown', (e)=>{
    const modal=document.getElementById('modal');
    if(e.key==='Escape' && modal.classList.contains('show')) closeModal();

    if((e.key==='Enter' || e.key===' ') && document.activeElement?.matches?.('.card-click[data-open-id]')) {
      e.preventDefault();
      openEventModal(document.activeElement.getAttribute('data-open-id'));
    }
  });
}
function setupTheme() {
  const root=document.documentElement;
  const btn=document.getElementById('themeToggle');
  const key='trip-theme-v10';
  const apply=(t, persist=true)=>{
    root.dataset.theme=t;
    btn.textContent = (t==='dark') ? 'â˜€ï¸' : 'ğŸŒ“';
    if(persist) localStorage.setItem(key,t);
  };
  const stored=localStorage.getItem(key);
  if(stored) apply(stored,false);
  else apply(window.matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light',false);
  btn.addEventListener('click', ()=>apply(root.dataset.theme==='dark'?'light':'dark'));
}

function applyFilter(filter) {
  const allEvents = window.__events || [];
  const sections = {
    timeline: document.getElementById('timeline'),
    flights: document.getElementById('flights'),
    stays: document.getElementById('stays'),
    tours: document.getElementById('tours')
  };

  const show = (el, on)=>{ if(!el) return; el.style.display = on ? "" : "none"; };

  // Decide which sections to show
  if(filter === 'all'){
    show(sections.timeline, true);
    show(sections.flights, true);
    show(sections.stays, true);
    show(sections.tours, true);
    renderTimeline(allEvents);
    return;
  }

  show(sections.timeline, true);
  show(sections.flights, filter==='flight');
  show(sections.stays, filter==='accommodation');
  show(sections.tours, filter==='tour');

  renderTimeline(allEvents.filter(e=>e.type===filter));
}

function setupNav() {
  const btns = [...document.querySelectorAll('.nav-btn')];
  const setActive = (id)=>btns.forEach(b=>b.classList.toggle('active', b.dataset.target===id));

  const targetToFilter = (t)=>{
    if(t==='timeline') return 'all';
    if(t==='flights') return 'flight';
    if(t==='stays') return 'accommodation';
    if(t==='tours') return 'tour';
    return 'all';
  };

  btns.forEach(b=>b.addEventListener('click', ()=>{
    const target = b.dataset.target;
    setActive(target);

    const filter = targetToFilter(target);
    applyFilter(filter);

    // Always take the user to the timeline first (filtered view)
    document.getElementById('timeline')?.scrollIntoView({behavior:'smooth'});
  }));

  setActive('timeline');
}
function setupBackToTop() {
  const btn=document.getElementById('backToTop');
  const toggle=()=>btn.classList.toggle('show', window.scrollY>420);
  window.addEventListener('scroll', toggle, {passive:true});
  btn.addEventListener('click', ()=>window.scrollTo({top:0, behavior:'smooth'}));
  toggle();
}

function init() {
  const trip = tripData;
  const events = normalizeEvents(trip);

  // Indexes for fast lookup (no index-based filtering bugs)
  const byId = new Map(events.map(e=>[e.raw.id, e]));
  const byType = events.reduce((acc, e)=>{
    (acc[e.type] ||= []).push(e);
    return acc;
  }, {});

  window.__trip = trip;
  window.__events = events;
  window.__byId = byId;
  window.__byType = byType;

  renderHero(events, trip);
  renderTimeline(events);
  applyFilter("all");
renderFlights(byType.flight || []);
  renderStays(byType.accommodation || []);
  renderTours(byType.tour || []);

  setupCopy();
  setupModal();
  setupTheme();
  setupNav();
  setupBackToTop();

  document.getElementById('generatedAt').textContent = new Date().toLocaleString('ko-KR');
}
init();</script>
</body>
</html>
